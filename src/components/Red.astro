---
import { Icon } from 'astro-icon';
---

<div class="container">
  <div class="red">
    <!-- <img src="/public/pokemon/red.svg" alt="" /> -->

    <Icon name="red" class="redImg" />

    <p class="redtext">
      <span class="js-splitText">pkmn trainer red</span>
      <span class="js-splitText">wants to battle!</span>
    </p>
  </div>
  <div class="pokemons"></div>
  <div class="load">
    <div class="load__img">
      <img src="/public/pokemon/back_01.png" alt="" />
    </div>
    <div class="load__img">
      <img src="/public/pokemon/back_02.png" alt="" />
    </div>
    <div class="load__img">
      <img src="/public/pokemon/back_03.png" alt="" />
    </div>
    <div class="load__img">
      <img src="/public/pokemon/back_04.png" alt="" />
    </div>
    <div class="load__img">
      <img src="/public/pokemon/back_05.png" alt="" />
    </div>
    <div class="load__img">
      <img src="/public/pokemon/back_06.png" alt="" />
    </div>
  </div>
</div>

<style lang="scss">
  @font-face {
    font-family: 'gameBoy';
    src:
      url('/public/font/EarlyGameBoy/Early-GameBoy.woff') format('woff'),
      url('/public/font/EarlyGameBoy/Early GameBoy.ttf') format('truetype');
  }
  .container {
    height: 100dvh;
    display: grid;
    place-content: center;
    font-family: 'gameBoy';
    background-color: #333;
  }

  .red {
    width: fit-content;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    // opacity: 0;
    // visibility: hidden;

    color: #fff;

    p {
      font-size: 4rem;
      margin-top: 40px;
      span {
        display: block;
      }
    }

    .redImg {
      width: 30%;
      margin: 0 auto;
      display: block;
    }
  }

  img {
    width: 100%;
    height: 100%;
  }

  .load {
    position: fixed;
    top: 0;
    left: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }
  .load__img {
    position: absolute;
    width: 25%;
    opacity: 0;
    visibility: hidden;
  }
  .redtext {
  }

  .js-splitText {
    overflow: hidden;
    &:nth-child(1) {
      margin-bottom: 20px;
    }
    &:nth-child(2) {
      margin-bottom: 20px;
    }
    span {
      opacity: 0;
      visibility: hidden;
      display: block;
    }
  }
</style>

<script>
  import { gsap } from 'gsap';

  const splitTexts = document.querySelectorAll<HTMLLIElement>('.js-splitText');

  [...splitTexts].forEach((e) => {
    const split = e.innerText.split('');
    const text = split
      .map((split: string) => `<span>${split.replace(/\r?\n/g, '&nbsp;')}</span>`)
      .join('');
    e.innerHTML = text;
  });
  // gsap.set('.js-splitText span', {
  //   autoAlpha: 0,
  //   yPercent: 100,
  //   display: 'inline-block',
  // });

  gsap.set('.load__img', { autoAlpha: 0 });
  const tl = gsap.timeline();

  tl.to('.load__img:nth-child(1)', {
    autoAlpha: 1,
    duration: 0,
    delay: 1,
    onStart: (e) => {
      gsap.set('.load__img:nth-child(1)', {
        zIndex: 2,
      });
    },
    onComplete: () => {
      gsap.set('.load__img:nth-child(1)', {
        zIndex: 1,
      });
    },
  })
    .to('.load__img:nth-child(2)', {
      autoAlpha: 1,
      duration: 0,
      delay: 0.15,
      onStart: (e) => {
        gsap.set('.load__img:nth-child(2)', {
          zIndex: 2,
        });
      },
      onComplete: () => {
        gsap.set('.load__img:nth-child(2)', {
          zIndex: 1,
        });
      },
    })
    .to('.load__img:nth-child(3)', {
      autoAlpha: 1,
      duration: 0,
      delay: 0.15,
      onStart: (e) => {
        gsap.set('.load__img:nth-child(3)', {
          zIndex: 2,
        });
      },
      onComplete: () => {
        gsap.set('.load__img:nth-child(3)', {
          zIndex: 1,
        });
      },
    })
    .to('.load__img:nth-child(4)', {
      autoAlpha: 1,
      duration: 0,
      delay: 0.15,
      onStart: (e) => {
        gsap.set('.load__img:nth-child(4)', {
          zIndex: 2,
        });
      },
      onComplete: () => {
        gsap.set('.load__img:nth-child(4)', {
          zIndex: 1,
        });
      },
    })
    .to('.load__img:nth-child(5)', {
      autoAlpha: 1,
      duration: 0,
      delay: 0.15,
      onStart: (e) => {
        gsap.set('.load__img:nth-child(5)', {
          zIndex: 2,
        });
      },
      onComplete: () => {
        gsap.set('.load__img:nth-child(5)', {
          zIndex: 1,
        });
      },
    })
    .to('.load__img:nth-child(6)', {
      autoAlpha: 1,
      duration: 0,
      delay: 0.15,
      onStart: (e) => {
        gsap.set('.load__img:nth-child(6)', {
          zIndex: 2,
        });
      },
      onComplete: () => {
        gsap.set('.load__img:nth-child(6)', {
          zIndex: 1,
        });
      },
    })
    .to('.load__img:nth-child(1)', {
      duration: 0,
      zIndex: 2,
      delay: 0.15,
    })
    .to('.load__img:nth-child(2)', {
      duration: 0,
      zIndex: 2,
      delay: 0.15,
    })
    .to('.load__img:nth-child(3)', {
      duration: 0,
      zIndex: 2,
      delay: 0.15,
    })
    .to('.load__img:nth-child(4)', {
      duration: 0,
      zIndex: 2,
      delay: 0.15,
    })
    .to('.load__img:nth-child(5)', {
      duration: 0,
      zIndex: 2,
      delay: 0.15,
    })
    .to('.load__img:nth-child(6)', {
      duration: 0,
      zIndex: 2,
      delay: 0.15,
    })
    .to('.load', {
      autoAlpha: 0,
      ease: 'power4.in',
      duration: 0.8,
    })
    .to('.red ', {
      autoAlpha: 1,
      duration: 0.8,
      ease: 'power4.in',
      onComplete: () => {
        const splitTexts = document.querySelectorAll('.js-splitText');
        splitTexts.forEach((e) => {
          const span = e.querySelectorAll('span');
          gsap.to(span, {
            autoAlpha: 1,
            duration: 0.8,
            yPercent: 0,
            ease: 'power4.in',
            stagger: 0.01,
          });
        });
      },
    });

  tl.paused(true);
</script>
